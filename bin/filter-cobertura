#!/usr/bin/env php
<?php

declare(strict_types=1);

use CoverageTools\Php\Cobertura\FilterCobertura;

$autoloadFound = false;

$autoloadPaths = [
    __DIR__ . '/../vendor/autoload.php', // when running inside the repo
    __DIR__ . '/../../../autoload.php', // when installed via Composer
];

foreach ($autoloadPaths as $file) {
    if (file_exists($file)) {
        require_once $file;
        $autoloadFound = true;

        break;
    }
}

if ($autoloadFound === false) {
    fwrite(STDERR,"Unable to locate Composer autoload.php. Did you run composer install?\n");
    exit(1);
}

if ($argc !== 3) {
    fwrite(STDERR, "Usage: filter-cobertura <input.xml> <output.xml>\n");
    exit(1);
}

$inputFile = $argv[1];
$outputFile = $argv[2];

try {
    FilterCobertura::run($inputFile, $outputFile);
} catch (Throwable $e) {
    fwrite(STDERR, $e->getMessage() . PHP_EOL);
    exit(2);
}
